<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì£¼ì‚¬ìœ„ ë³´ë“œê²Œì„ (ì´ë¦„ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ + ì…ë ¥ ì´ë™)</title>
<style>
  :root{
    --accent:#2563eb;
    --sidebar: 420px; /* ì‚¬ì´ë“œ íŒ¨ë„ í­: í•„ìš”í•˜ë©´ 380~460pxë¡œ ì¡°ì • */
    --gap: 24px;      /* ì¢Œ/ìš° ì»¬ëŸ¼ ê°„ê²© */
    --pad: 20px;      /* ë°”ê¹¥ íŒ¨ë”© */
  }
  *{ box-sizing:border-box; }
  html, body{ height:100%; }
  body{
    margin:0;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
    background:#f6f7fb;
  }

  /* ë ˆì´ì•„ì›ƒ: í•œ í™”ë©´ì— ë”± ë§ì¶”ê¸° */
  .wrap{
    display:flex; gap:var(--gap); padding:var(--pad);
    align-items:flex-start; height:100vh; overflow:hidden;
  }

  /* ë³´ë“œ ì»¨í…Œì´ë„ˆ: í™”ë©´ ì•ˆìœ¼ë¡œ ì œí•œ */
  #game-container{
    position:relative; display:inline-block; border-radius:16px; overflow:hidden; background:#fff;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
    max-width: calc(100vw - var(--sidebar) - var(--gap) - var(--pad)*2);
    max-height: calc(100vh - var(--pad)*2);
  }
  /* ì´ë¯¸ì§€ê°€ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ëŠ˜/ì¤„ì–´ í™”ë©´ì— ë§ê²Œ */
  #board{ display:block; width:100%; height:auto; max-height: calc(100vh - var(--pad)*2); }

  /* ë§(í† í°) â€” ìš”ì²­: ì¡°ê¸ˆ ì‘ê²Œ */
  .piece{
    position:absolute;
    width:18px; height:18px;          /* ê¸°ì¡´ 24px â†’ 18px */
    border-radius:50%;
    border:2px solid #000;
    transform:translate(-50%,-50%);
    box-shadow:0 2px 6px rgba(0,0,0,.25);
  }
  .piece::after{
    content:attr(data-i);
    position:absolute; inset:-2px;
    display:flex; align-items:center; justify-content:center;
    font-size:10px;                    /* ê¸€ìë„ ì‚´ì§ ì¶•ì†Œ */
    font-weight:800; color:#111;
    text-shadow:0 1px 2px rgba(255,255,255,.8);
  }

  aside{
    width:var(--sidebar); background:#fff; border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.08); padding:18px;
    position:sticky; top:20px;
    max-height: calc(100vh - var(--pad)*2);
    overflow:auto;
  }
  h1{ margin:0 0 8px; font-size:20px; }
  .row{ display:flex; gap:10px; align-items:center; margin:8px 0; }
  .row > *{ flex:1; }
  label{ font-size:13px; color:#333; display:block; }
  input[type="number"], input[type="text"], select{
    width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:10px; outline:none; font-size:14px;
  }
  .btn{ appearance:none; border:none; border-radius:12px; padding:10px 12px; background:#111; color:#fff; font-weight:700; cursor:pointer; }
  .btn.accent{ background:var(--accent); }
  .btn.ghost{ background:#eef2ff; color:#1e1b4b; }
  .btn.warn{ background:#e11d48; }
  .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .sep{ height:1px; background:#eee; margin:12px 0; }
  #message{ color:#065f46; font-weight:700; min-height:22px; }
  #log{ font-size:12px; background:#0b1020; color:#cbd5e1; padding:10px; border-radius:10px; height:160px; overflow:auto; }
  #nameList{ font-size:13px; line-height:1.7; color:#111; background:#fafafa; border:1px solid #eee; border-radius:10px; padding:10px; }
</style>
</head>
<body>
<div class="wrap">
  <div id="game-container">
    <!-- ê°™ì€ í´ë”ì— board.pngë¥¼ ë‘ì„¸ìš” -->
    <img id="board" src="dice_game.png" alt="ë³´ë“œê²Œì„íŒ" />
  </div>

  <aside>
    <h1>ì£¼ì‚¬ìœ„ ê²Œì„</h1>

    <div class="row">
      <label>ë§ ì„ íƒ
        <select id="pieceSelect"></select>
      </label>
      <label>ì¸ì›ìˆ˜
        <select id="playerCount">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </label>
    </div>

    <div class="row">
      <label>ì£¼ì‚¬ìœ„ 1
        <input id="dice1" type="number" min="1" max="6" value="1" />
      </label>
      <label>ì£¼ì‚¬ìœ„ 2
        <input id="dice2" type="number" min="1" max="6" value="1" />
      </label>
    </div>
    <div class="grid2">
      <button id="rollBtn" class="btn accent">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
      <button id="moveBtn" class="btn">ì´ë™</button>
    </div>

    <div class="sep"></div>

    <!-- ë§ ì´ë¦„ í¸ì§‘ ì˜ì—­ -->
    <div class="row">
      <label>í˜„ì¬ ë§ ì´ë¦„
        <input id="nameInput" type="text" placeholder="ì˜ˆ: ì–‘ë–¼" />
      </label>
      <button id="saveNameBtn" class="btn ghost" style="flex:0 0 auto;">ì´ë¦„ ì €ì¥</button>
    </div>
    <div id="nameList"></div>

    <div class="sep"></div>
    <div class="grid2">
      <button id="resetBtn" class="btn warn">ë¦¬ì…‹</button>
      <button id="saveBtn" class="btn ghost">ì €ì¥</button>
    </div>
    <div id="message"></div>

    <div class="sep"></div>
    <div id="log"></div>
  </aside>
</div>

<script>
// ===== ì¢Œí‘œ (ì›ë³¸ ì´ë¯¸ì§€ í•´ìƒë„ ê¸°ì¤€) =====
const positions =[
    [4879,7547],[4205,7262],[3593,7315],[3107,7065],[2571,7150],
    [2178,6788],[1736,6833],[1482,6494],[1048,6327],[754,5887],
    [924,5467],[1625,5369],[1910,5119],[2357,5217],[2727,4928],
    [3089,4945],[3423,4779],[3749,4811],[3937,4547],[4401,4476],
    [4307,4177],[4414,3873],[3964,3766],[3763,3529],[3388,3601],
    [3165,3427],[2928,3404],[2745,3235],[2388,3235],[2160,3163],
    [1973,3137],[1759,2994],[1468,2989],[1268,2797],[1013,2637],
    [1116,2458],[1210,2235],[1553,2168],[1812,2190],[2000,2065],
    [2218,2128],[2410,2052],[2602,2123],[2821,1998],[2990,2007],
    [3232,1958],[3526,1904],[3415,1686],[3142,1529],[4388,918]
];

// (ì„ íƒ) ìˆœê°„ì´ë™ ê·œì¹™ â€” ì›í•˜ë©´ ìˆ˜ì •/ì¶”ê°€í•˜ì„¸ìš”
const warps = { 3:8, 29:23, 44:37 };

// ===== ê¸°ë³¸ ì„¤ì • =====
const totalCells = positions.length;
const maxPieces = 8;
const pieceColors = ["#ef4444","#3b82f6","#22c55e","#f59e0b","#a855f7","#ec4899","#eab308","#06b6d4"];

let piecePositions = JSON.parse(localStorage.getItem('piecePositions_v4')||'null') || Array(maxPieces).fill(1);
/* ë§ ì´ë¦„: ê¸°ë³¸ì€ '1','2','3'â€¦ â†’ ì‚¬ìš©ì ì…ë ¥ìœ¼ë¡œ êµì²´ */
let pieceNames = JSON.parse(localStorage.getItem('pieceNames_v2')||'null')
                || Array(maxPieces).fill('').map((_,i)=> String(i+1));

const container = document.getElementById('game-container');
const board = document.getElementById('board');
const pieceSelect = document.getElementById('pieceSelect');
const playerCountSel = document.getElementById('playerCount');
const dice1El = document.getElementById('dice1');
const dice2El = document.getElementById('dice2');
const moveBtn = document.getElementById('moveBtn');
const rollBtn = document.getElementById('rollBtn');
const resetBtn = document.getElementById('resetBtn');
const saveBtn = document.getElementById('saveBtn');
const msgEl = document.getElementById('message');
const logEl = document.getElementById('log');
const nameInput = document.getElementById('nameInput');
const saveNameBtn = document.getElementById('saveNameBtn');
const nameList = document.getElementById('nameList');

// ë§ DOM
const pieces = [];
for (let i=0;i<maxPieces;i++){
  const el=document.createElement('div');
  el.className='piece';
  el.style.background=pieceColors[i];
  el.dataset.i = pieceNames[i] || String(i+1); // â† ì»¤ìŠ¤í…€ ì´ë¦„ í‘œì‹œ
  container.appendChild(el);
  pieces.push(el);
}

// ì…€ë ‰íŠ¸ ì±„ìš°ê¸°
function fillSelect(){
  pieceSelect.innerHTML='';
  const cnt = parseInt(playerCountSel.value);
  for (let i=1;i<=cnt;i++){
    const op=document.createElement('option');
    const label = pieceNames[i-1] && pieceNames[i-1]!==String(i) ? `${i}ë²ˆ ë§ â€” ${pieceNames[i-1]}` : `${i}ë²ˆ ë§`;
    op.value=i; op.textContent=label;
    pieceSelect.appendChild(op);
  }
  // ì„ íƒëœ ë§ì˜ ì´ë¦„ ì…ë ¥ì¹¸ ê°±ì‹ 
  syncNameInput();
}

// ë³´ë“œ ìŠ¤ì¼€ì¼ ë³€í™˜
function getScale(){
  return { scaleX: board.clientWidth / board.naturalWidth, scaleY: board.clientHeight / board.naturalHeight };
}
function natToScreen([x,y]){ const {scaleX,scaleY}=getScale(); return [x*scaleX, y*scaleY]; }

// ë§ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
function updatePiecePositions(){
  const cnt = parseInt(playerCountSel.value);
  pieces.forEach((el,idx)=>{
    if (idx<cnt){
      el.style.display='block';
      const cell = clamp(piecePositions[idx],1,totalCells);
      const [x,y] = positions[cell-1];
      const [sx,sy] = natToScreen([x,y]);
      el.style.left = sx + 'px';
      el.style.top  = sy + 'px';
      // ë¼ë²¨ì€ ìµœì‹  ì´ë¦„ìœ¼ë¡œ
      el.dataset.i = pieceNames[idx] || String(idx+1);
    } else {
      el.style.display='none';
    }
  });
  localStorage.setItem('piecePositions_v4', JSON.stringify(piecePositions));
}

function updateSelectLabels(){
  // ì˜µì…˜ í…ìŠ¤íŠ¸ë„ ìµœì‹  ì´ë¦„ ë°˜ì˜
  Array.from(pieceSelect.options).forEach((op,i)=>{
    const idx = i; const num = idx+1;
    const label = pieceNames[idx] && pieceNames[idx]!==String(num) ? `${num}ë²ˆ ë§ â€” ${pieceNames[idx]}` : `${num}ë²ˆ ë§`;
    op.textContent = label;
  });
}

// ì´ë¦„ ì…ë ¥ì¹¸ ë™ê¸°í™”
function syncNameInput(){
  const idx = (parseInt(pieceSelect.value)||1)-1;
  nameInput.value = pieceNames[idx] || String(idx+1);
  renderNameList();
}

// ë§ ì´ë¦„ ëª©ë¡ ë Œë”
function renderNameList(){
  const cnt = parseInt(playerCountSel.value);
  const items = [];
  for (let i=0;i<cnt;i++){
    const n = pieceNames[i] || String(i+1);
    items.push(`${i+1}ë²ˆ ë§ : ${n}`);
  }
  nameList.textContent = items.join('\n');
}

// ë„ìš°ë¯¸
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function log(t){ const time = new Date().toLocaleTimeString(); logEl.innerHTML = `[${time}] ${t}<br>` + logEl.innerHTML; }
function setMsg(t,ok=true){ msgEl.style.color = ok? '#065f46':'#991b1b'; msgEl.textContent=t; }
function roll(){ return 1 + Math.floor(Math.random()*6); }

// ì´ë™ ì²˜ë¦¬
function applyMove(selectedIndex, d1, d2){
  const idx = selectedIndex - 1;
  const sum = clamp(parseInt(d1)||0,1,6) + clamp(parseInt(d2)||0,1,6);
  let newPos = piecePositions[idx] + sum;
  if (newPos > totalCells) newPos = totalCells;
  if (warps[newPos]) newPos = warps[newPos];
  piecePositions[idx] = newPos;
  updatePiecePositions();

  const name = pieceNames[idx] || String(selectedIndex);
  if (newPos === totalCells){
    setMsg(`${selectedIndex}ë²ˆ ë§(${name})ì´ ê²°ìŠ¹ì  ë„ì°©! ğŸ‰`);
    log(`${selectedIndex}ë²ˆ ë§(${name}) FINISH`);
  } else {
    setMsg(`${selectedIndex}ë²ˆ ë§(${name})ì´ ${newPos}ë²ˆ ì¹¸ìœ¼ë¡œ ì´ë™ (í•©ê³„ ${sum})`);
    log(`${selectedIndex}ë²ˆ ë§(${name}): +${sum} â†’ ${newPos}`);
  }
}

// ì´ë²¤íŠ¸ ë°”ì¸ë”©
moveBtn.addEventListener('click',()=>{
  applyMove(parseInt(pieceSelect.value), dice1El.value, dice2El.value);
});
rollBtn.addEventListener('click',()=>{
  const r1=roll(), r2=roll();
  dice1El.value=r1; dice2El.value=r2;
  applyMove(parseInt(pieceSelect.value), r1, r2);
});
resetBtn.addEventListener('click',()=>{
  piecePositions = Array(maxPieces).fill(1);
  updatePiecePositions();
  setMsg('ë¦¬ì…‹ ì™„ë£Œ.');
  log('ëª¨ë“  ë§ ìœ„ì¹˜ 1ë²ˆìœ¼ë¡œ ì´ˆê¸°í™”');
});
saveBtn.addEventListener('click',()=>{
  localStorage.setItem('piecePositions_v4', JSON.stringify(piecePositions));
  localStorage.setItem('pieceNames_v2', JSON.stringify(pieceNames));
  setMsg('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
});

// ì´ë¦„ ì €ì¥
saveNameBtn.addEventListener('click',()=>{
  const idx = (parseInt(pieceSelect.value)||1)-1;
  const val = (nameInput.value || '').trim();
  pieceNames[idx] = val || String(idx+1); // ë¹ˆ ê°’ì´ë©´ ë²ˆí˜¸ë¡œ
  localStorage.setItem('pieceNames_v2', JSON.stringify(pieceNames));
  updatePiecePositions();   // í† í° ë¼ë²¨ ì¦‰ì‹œ ë°˜ì˜
  updateSelectLabels();     // ì…€ë ‰íŠ¸ ë¼ë²¨ ê°±ì‹ 
  renderNameList();
  setMsg(`${idx+1}ë²ˆ ë§ ì´ë¦„ì´ "${pieceNames[idx]}"(ìœ¼)ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
});

// ì„ íƒ/ì¸ì›ìˆ˜ ë³€ê²½ ì‹œ
pieceSelect.addEventListener('change', syncNameInput);
playerCountSel.addEventListener('change',()=>{ fillSelect(); updatePiecePositions(); renderNameList(); });

window.addEventListener('resize', updatePiecePositions);
board.addEventListener('load', ()=>{ updatePiecePositions(); fillSelect(); renderNameList(); });
if (board.complete){ updatePiecePositions(); fillSelect(); renderNameList(); }
</script>
</body>
</html>
